<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abel|Open+Sans|Source+Sans+Pro" />
<% if current_user && current_user.id == @petition.user_id && !@petition.public %>
  <div class="notice alert alert-info petition-notice-hidden" id="petition-notice">
    <p>This is petition is currently private.  Click here to make this public.</p>
  </div>
<% end %>
<div class="petition-page-header">
  <h1 class="petition-page-title"><%= @petition.title %></h1>
  <%= link_to user_path(@petition.user) do %>
  <div class="profile-icon">
      <% if @petition.user.profile_pic.url %>
        <img class="picture img-circle" src=<%= image_path(@petition.user.profile_pic.url) %> alt="Profile picture">
      <% else %>
        <img class="picture img-circle" src=<%= image_path("default_profile_picture.png") %> alt="Profile picture">
      <% end %>
  </div>
  <div class="petition-page-author">
    <p><%= @petition.user.first_name + " " + @petition.user.last_name %></p>
  </div>
  <% end %>
</div>

<% if current_user and @petition.user.id == current_user.id %>
  <div class="container" style="margin-bottom: 50px;">
    <%= link_to "Delete Post", petition_path(@petition.id), method: :delete %>
  </div>
<% end %>

<div class="pet-container">
  <div class="pet-content">
    <div class="pet-img-container">
      <div class="tag">
        <% if @petition.status == "closed" %>
          <img src=<%= image_path("closed_badge.png") %>>
        <% elsif @petition.status == "victory" %>
          <img src=<%= image_path("victory_badge.png") %>>
        <% else %>
          <img src=<%= image_path("active_badge.png") %>>
        <% end %>
      </div>
      <% if @petition.image.url %>
        <img src=<%= image_path(@petition.image.url) %> width="700" height="450"/>
      <% else %>
        <img src="http://www.placehold.it/700x450"/>
      <% end %>
    </div>
    <p><%= @petition.description %></p>

    <p class="bottom-petition-text">This petition will be delivered to:</p>
    <% recievers = get_recievers(@petition) %>
    <% if recievers %>
      <% get_recievers(@petition).each do |reciever| %>
        <p class="board-members"><%= reciever %></p>
      <% end %>
    <% end %>
  </div>
  <div class="share-container">
    <div class="share-card">
      <% if @petition.status == "closed" %>
        <h3 class="share-title">Petition Closed!</h3>
      <% elsif @petition.status == "victory" %>
        <h3 class="share-title">Petition Closed!</h3>
      <% else %>
        <h3 class="share-title">Sign Petition!</h3>
      <% end %>
      <ul style="padding-left:20px">
        <li>
          <img class="share-icon" src="/assets/default_profile_picture.png">
        </li>
        <li>
          <p style="letter-spacing:0.9px; font-size:16px"><%= @petition.signatures.count + 1 %>/<%= @petition.goal %> Supporters</p>
        </li>
      </ul>
      <progress value=<%= @petition.signatures.count + 1 %> max=<%= @petition.goal %>></progress>
      <% if @petition.status == "closed" or @petition.status == "victory" %>
        <p style="margin-left: 20px">Signatures are Closed</p>
        <%= link_to image_tag("/assets/facebook_share_button", class: "share-facebook"), "http://www.facebook.com/sharer.php?u=#{petition_url(@petition)}" %>
        <%= link_to "Tweet it", "http://twitter.com/home?status=#{@petition.title} #{petition_url(@petition)}" %>
      <% elsif !current_user %>
        <p style="margin-left: 20px">You must be signed in to sign this petition</p>
        <%= link_to image_tag("/assets/facebook_share_button", class: "share-facebook"), "http://www.facebook.com/sharer.php?u=#{petition_url(@petition)}" %>
        <%= link_to "Tweet it", "http://twitter.com/home?status=#{@petition.title} #{petition_url(@petition)}" %>
      <% elsif current_user.id != @petition.user.id and !current_user.petitions.exists?(@petition.id) %>
        <%= form_for @signature, html: {style: 'height: 100%;'} do |f| %>
          <%= f.hidden_field :user_id, value: current_user.id %>
          <%= f.hidden_field :petition_id, value: @petition.id %>
          <%= f.text_area :reason, label: false, class: "write-box", placeholder: "I am supporting this petition because..." %>

          <%= submit_tag 'SIGN', class: 'btn btn-primary' %>
          <%= link_to image_tag("/assets/facebook_share_button", class: "share-facebook"), "http://www.facebook.com/sharer.php?u=#{petition_url(@petition)}" %>
          <%= link_to "Tweet it", "http://twitter.com/home?status=#{@petition.title} #{petition_url(@petition)}" %>
        <% end %>
      <% else %>
        <p style="margin-left: 20px">You signed this petition</p>
        <%= link_to image_tag("/assets/facebook_share_button", class: "share-facebook"), "http://www.facebook.com/sharer.php?u=#{petition_url(@petition)}" %>
        <%= link_to "Tweet it", "http://twitter.com/home?status=#{@petition.title} #{petition_url(@petition)}" %>
      <% end %>
    </div>
  </div>
</div>

<%= render "comments/template", commentable: @petition, new_comment: @comment %>
<%= javascript_include_tag 'petitions', 'data-turbolinks-track': 'reload' %>
